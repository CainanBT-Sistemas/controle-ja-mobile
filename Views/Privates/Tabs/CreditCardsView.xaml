<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:controle_ja_mobile.ViewModels"
             xmlns:models="clr-namespace:controle_ja_mobile.Models"
             xmlns:micro="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             x:Class="controle_ja_mobile.Views.Privates.Tabs.CreditCardsView">

    <Grid RowDefinitions="*, Auto" BackgroundColor="{StaticResource PageBackgroundColorDark}">

        <RefreshView Grid.Row="0" IsRefreshing="{Binding IsRefreshing}" Command="{Binding LoadCardsAsyncCommand}" RefreshColor="{StaticResource Primary}">
            <CollectionView ItemsSource="{Binding Cards}" Margin="20">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="20"/>
                </CollectionView.ItemsLayout>

                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="10" Opacity="0.6">
                        <Label Text="Nenhum cartão encontrado" TextColor="White"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:CreditCard">
                        <Border StrokeShape="RoundRectangle 15" StrokeThickness="0" BackgroundColor="#1E293B" Padding="15">
                            <VerticalStackLayout Spacing="15">

                                <Grid ColumnDefinitions="Auto, *, Auto">
                                    <Border BackgroundColor="#E2E8F0" HeightRequest="30" WidthRequest="45" StrokeShape="RoundRectangle 5" HorizontalOptions="Start" Opacity="0.9">
                                        <Label Text="CARD" FontSize="8" TextColor="Black" HorizontalOptions="Center" VerticalOptions="Center" FontAttributes="Bold"/>
                                    </Border>
                                    <Label Grid.Column="1" Text="{Binding Name}" TextColor="White" FontAttributes="Bold" FontSize="18" Margin="10,0,0,0" VerticalOptions="Center"/>
                                    <Label Grid.Column="2" Text="****" TextColor="#64748B" FontSize="14" VerticalOptions="Center"/>
                                </Grid>

                                <BoxView HeightRequest="1" Color="#2D3A4F"/>

                                <Grid ColumnDefinitions="*, 110">

                                    <VerticalStackLayout Grid.Column="0" Spacing="10" VerticalOptions="Center">

                                        <Grid ColumnDefinitions="*,*">
                                            <VerticalStackLayout>
                                                <Label Text="Disponível" TextColor="#94A3B8" FontSize="10"/>
                                                <Label Text="{Binding FormattedAvailable}" TextColor="{StaticResource Primary}" FontAttributes="Bold" FontSize="14"/>
                                            </VerticalStackLayout>
                                            <VerticalStackLayout Grid.Column="1">
                                                <Label Text="Fatura Atual" TextColor="#94A3B8" FontSize="10"/>
                                                <Label Text="{Binding FormattedUsed}" TextColor="#FF5252" FontAttributes="Bold" FontSize="14"/>
                                            </VerticalStackLayout>
                                        </Grid>

                                        <VerticalStackLayout Spacing="5" Margin="0,5,0,0">
                                            <Grid ColumnDefinitions="*, Auto">
                                                <Label Text="Limite Utilizado" TextColor="#94A3B8" FontSize="10"/>
                                                <Label Text="{Binding UsedPercentageText}" TextColor="White" FontSize="10" Grid.Column="1"/>
                                            </Grid>
                                            <ProgressBar Progress="{Binding LimitProgress}" ProgressColor="{StaticResource Primary}" ScaleY="2"/>
                                            <Label Text="{Binding FormattedTotalLimit}" TextColor="#64748B" FontSize="10" HorizontalOptions="End"/>
                                        </VerticalStackLayout>

                                        <Label Text="{Binding InvoiceInfo}" TextColor="#94A3B8" FontSize="10" Margin="0,5,0,0"/>
                                    </VerticalStackLayout>

                                    <Grid Grid.Column="1" HeightRequest="100" WidthRequest="100" VerticalOptions="Center" HorizontalOptions="End">
                                        <micro:ChartView Chart="{Binding CategoryChart}" IsVisible="{Binding HasChartData}" BackgroundColor="Transparent"/>

                                        <Label Text="Sem gastos" 
                                               IsVisible="{Binding HasChartData, Converter={StaticResource InvertedBoolConverter}}"
                                               TextColor="#64748B" FontSize="10" 
                                               HorizontalOptions="Center" VerticalOptions="Center" HorizontalTextAlignment="Center"/>
                                    </Grid>
                                </Grid>
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <Button Grid.Row="0" Text="+" Command="{Binding GoToAddCardCommand}" 
                BackgroundColor="{StaticResource Primary}" TextColor="Black"
                CornerRadius="30" HeightRequest="60" WidthRequest="60"
                HorizontalOptions="End" VerticalOptions="End" Margin="25"
                Shadow="{Shadow Radius=10, Offset='0,5', Brush='#00E676'}"/>
    </Grid>
</ContentView>