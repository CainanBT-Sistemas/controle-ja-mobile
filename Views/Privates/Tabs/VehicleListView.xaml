<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:controle_ja_mobile.Models"
             xmlns:vm="clr-namespace:controle_ja_mobile.ViewModels"
             x:Class="controle_ja_mobile.Views.Privates.Tabs.VehicleListView"
             x:DataType="vm:VehiclesViewModel">

    <Grid RowDefinitions="Auto,*" BackgroundColor="{StaticResource PageBackgroundColorDark}">

        <!-- Header com nome do usuÃ¡rio e menu de configuraÃ§Ãµes -->
        <Grid Grid.Row="0" ColumnDefinitions="*, Auto" Padding="25,15,25,10" BackgroundColor="{StaticResource PageBackgroundColorDark}">
            <VerticalStackLayout>
                <Label Text="Bem-vindo," TextColor="#94A3B8" FontSize="14"/>
                <Label Text="{Binding UserName}" TextColor="White" FontSize="20" FontAttributes="Bold"/>
            </VerticalStackLayout>

            <HorizontalStackLayout Grid.Column="1" Spacing="15">
                <Border StrokeThickness="0" BackgroundColor="#1E293B" HeightRequest="40" WidthRequest="40" StrokeShape="RoundRectangle 20">
                    <Grid>
                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ToggleSettingsMenuCommand}"/>
                        </Grid.GestureRecognizers>

                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal">
                                    <VisualState.Setters>
                                        <Setter Property="Opacity" Value="1" />
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="Pressed">
                                    <VisualState.Setters>
                                        <Setter Property="Opacity" Value="0.5" />
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>

                        <Path Data="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.06-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.49l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.06,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" Fill="#94A3B8" Aspect="Uniform" HeightRequest="20" WidthRequest="20" HorizontalOptions="Center" VerticalOptions="Center" InputTransparent="True"/>
                    </Grid>
                </Border>

                <Border Stroke="Transparent" HeightRequest="40" WidthRequest="40" StrokeShape="RoundRectangle 20">
                    <Image Source="logo_controle.png" Aspect="AspectFit"/>
                </Border>
            </HorizontalStackLayout>
        </Grid>

        <RefreshView Grid.Row="1" IsRefreshing="{Binding IsRefreshing}" Command="{Binding LoadVehiclesCommand}" RefreshColor="{StaticResource Primary}">
            <CollectionView ItemsSource="{Binding Vehicles}" Margin="20">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="15"/>
                </CollectionView.ItemsLayout>

                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="10" Opacity="0.5">
                        <Label Text="Nenhum veÃ­culo cadastrado" TextColor="White"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Vehicle">
                        <Border StrokeShape="RoundRectangle 20" StrokeThickness="0" BackgroundColor="{StaticResource CardBackgroundDark}" HeightRequest="130">
                            <Grid ColumnDefinitions="10, *, Auto" RowDefinitions="*, Auto">
                                <BoxView Grid.RowSpan="2" Color="{StaticResource Primary}" WidthRequest="5"/>

                                <VerticalStackLayout Grid.Column="1" Padding="15,15,0,0" Spacing="2">
                                    <Label Text="{Binding Name}" TextColor="{StaticResource Primary}" FontAttributes="Bold" FontSize="18"/>
                                    <Label Text="{Binding FullDescription}" TextColor="{StaticResource TextSecondaryDark}" FontSize="14"/>
                                    <Border Margin="0,10,0,0" HorizontalOptions="Start" BackgroundColor="#2D3A4F" StrokeThickness="0" Padding="10,5" StrokeShape="RoundRectangle 8">
                                        <Label Text="{Binding ConsumptionInfo}" TextColor="#E2E8F0" FontSize="11"/>
                                    </Border>
                                </VerticalStackLayout>

                                <VerticalStackLayout Grid.Column="2" Grid.Row="0" Padding="0,15,15,0" HorizontalOptions="End">
                                    <Label Text="KM Atual" TextColor="{StaticResource TextSecondaryDark}" FontSize="10" HorizontalOptions="End"/>
                                    <Label Text="{Binding FormattedOdometer}" TextColor="White" FontAttributes="Bold" FontSize="16" HorizontalOptions="End"/>
                                </VerticalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <Button Grid.Row="1" Text="+" Command="{Binding GoToAddPageCommand}"
                BackgroundColor="{StaticResource Primary}" TextColor="Black" FontSize="24"
                CornerRadius="30" HeightRequest="60" WidthRequest="60"
                HorizontalOptions="End" VerticalOptions="End" Margin="25"
                Shadow="{Shadow Radius=10, Offset='0,5', Brush='#00E676'}"/>

        <ActivityIndicator Grid.RowSpan="2" IsRunning="{Binding IsLoading}" IsVisible="{Binding IsLoading}" 
                           Color="{StaticResource Primary}" VerticalOptions="Center" HorizontalOptions="Center"/>

        <!-- Menu Lateral (Side Menu) -->
        <Grid Grid.RowSpan="2" IsVisible="{Binding IsSettingsMenuVisible}">

            <BoxView Color="Black" Opacity="0.5" HorizontalOptions="Fill" VerticalOptions="Fill">
                <BoxView.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding CloseSettingsMenuCommand}" />
                </BoxView.GestureRecognizers>
            </BoxView>

            <Border BackgroundColor="#1E293B" 
                    StrokeThickness="0" 
                    HorizontalOptions="End" 
                    VerticalOptions="Fill"
                    WidthRequest="280"
                    Padding="0">

                <Border.Shadow>
                    <Shadow Brush="Black" Offset="-2,0" Radius="10" Opacity="0.3"/>
                </Border.Shadow>

                <VerticalStackLayout Spacing="0" Padding="0,60,0,0">

                    <!-- Header do Menu -->
                    <VerticalStackLayout Padding="20,20,20,30" BackgroundColor="#0F172A">
                        <Label Text="Menu" TextColor="#94A3B8" FontSize="12" Opacity="0.8"/>
                        <Label Text="{Binding UserName}" TextColor="White" FontSize="20" FontAttributes="Bold" Margin="0,5,0,0"/>
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" Color="#334155" />

                    <!-- Menu Items -->
                    <Grid Padding="20,15" BackgroundColor="Transparent">
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal" />
                                <VisualState x:Name="Pressed">
                                    <VisualState.Setters>
                                        <Setter Property="BackgroundColor" Value="#334155" />
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>

                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding GoToProfileCommand}"/>
                        </Grid.GestureRecognizers>
                        <Label Text="ðŸ‘¤  Meu Perfil" TextColor="White" FontSize="16" InputTransparent="True"/>
                    </Grid>

                    <BoxView HeightRequest="1" Color="#334155" Margin="20,0" />

                    <Grid Padding="20,15" BackgroundColor="Transparent">
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal" />
                                <VisualState x:Name="Pressed">
                                    <VisualState.Setters>
                                        <Setter Property="BackgroundColor" Value="#334155" />
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>

                        <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding PerformLogoutCommand}"/>
                        </Grid.GestureRecognizers>
                        <Label Text="ðŸšª  Sair da Conta" TextColor="#EF4444" FontSize="16" FontAttributes="Bold" InputTransparent="True"/>
                    </Grid>

                </VerticalStackLayout>
            </Border>
        </Grid>
    </Grid>
</ContentView>