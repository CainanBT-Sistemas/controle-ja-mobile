<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:controle_ja_mobile.Models"
             xmlns:vm="clr-namespace:controle_ja_mobile.ViewModels"
             xmlns:micro="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             x:Class="controle_ja_mobile.Views.Privates.Tabs.VehicleListView">

    <Grid RowDefinitions="*, Auto" BackgroundColor="{StaticResource PageBackgroundColorDark}">

        <RefreshView Grid.Row="0" IsRefreshing="{Binding IsRefreshing}" Command="{Binding LoadVehiclesCommand}" RefreshColor="{StaticResource Primary}">
            <CollectionView ItemsSource="{Binding Vehicles}" Margin="20">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="20"/>
                </CollectionView.ItemsLayout>

                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="10" Opacity="0.5">
                        <Label Text="Nenhum veículo cadastrado" TextColor="White"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Vehicle">
                        <Border StrokeShape="RoundRectangle 20" StrokeThickness="0" BackgroundColor="#1E293B" Padding="15">
                            <VerticalStackLayout Spacing="10">

                                <Grid ColumnDefinitions="*, Auto">
                                    <VerticalStackLayout Spacing="2">
                                        <Label Text="{Binding Name}" TextColor="{StaticResource Primary}" FontAttributes="Bold" FontSize="18"/>
                                        <Label Text="{Binding FullDescription}" TextColor="#94A3B8" FontSize="12"/>
                                    </VerticalStackLayout>
                                    <Border BackgroundColor="#2D3A4F" StrokeThickness="0" Padding="8,4" StrokeShape="RoundRectangle 5" VerticalOptions="Start">
                                        <Label Text="{Binding Plate}" TextColor="White" FontSize="12" FontAttributes="Bold"/>
                                    </Border>
                                </Grid>

                                <BoxView HeightRequest="1" Color="#2D3A4F"/>

                                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="5">
                                    <VerticalStackLayout HorizontalOptions="Center">
                                        <Label Text="Odômetro" TextColor="#64748B" FontSize="10" HorizontalOptions="Center"/>
                                        <Label Text="{Binding FormattedOdometer}" TextColor="White" FontSize="12" FontAttributes="Bold" HorizontalOptions="Center"/>
                                    </VerticalStackLayout>

                                    <VerticalStackLayout HorizontalOptions="Center">
                                        <Label Text="Média" TextColor="#64748B" FontSize="10" HorizontalOptions="Center"/>
                                        <Label Text="{Binding ConsumptionInfo}" TextColor="{StaticResource Primary}" FontSize="11" FontAttributes="Bold" HorizontalOptions="Center" HorizontalTextAlignment="Center"/>
                                    </VerticalStackLayout>

                                    <VerticalStackLayout HorizontalOptions="Center">
                                        <Label Text="Gasto Mês" TextColor="#64748B" FontSize="10" HorizontalOptions="Center"/>
                                        <Label Text="{Binding MonthlyCost}" TextColor="#FF5252" FontSize="12" FontAttributes="Bold" HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </Grid>

                                <Label Text="Histórico de Despesas" TextColor="#64748B" FontSize="10" Margin="0,5,0,0"/>
                                <Border HeightRequest="120" StrokeThickness="0" BackgroundColor="Transparent">
                                    <micro:ChartView Chart="{Binding ExpensesChart}" BackgroundColor="Transparent"/>
                                </Border>

                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <Button Grid.Row="0" Text="+" Command="{Binding GoToAddPageCommand}"
                BackgroundColor="{StaticResource Primary}" TextColor="Black" FontSize="24"
                CornerRadius="30" HeightRequest="60" WidthRequest="60"
                HorizontalOptions="End" VerticalOptions="End" Margin="25"
                Shadow="{Shadow Radius=10, Offset='0,5', Brush='#00E676'}"/>

        <ActivityIndicator Grid.RowSpan="2" IsRunning="{Binding IsLoading}" IsVisible="{Binding IsLoading}" 
                           Color="{StaticResource Primary}" VerticalOptions="Center" HorizontalOptions="Center"/>
    </Grid>
</ContentView>