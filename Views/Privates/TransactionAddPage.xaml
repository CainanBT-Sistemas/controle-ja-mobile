<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:controle_ja_mobile.ViewModels"
             x:Class="controle_ja_mobile.Views.Privates.TransactionAddPage"
             x:DataType="vm:TransactionAddViewModel"
             Title="Novo Lançamento"
             BackgroundColor="{StaticResource PageBackgroundColorDark}">

    <Grid>
        <ScrollView>
            <VerticalStackLayout Padding="25" Spacing="20">

                <Label Text="{Binding PageTitle}" TextColor="{Binding ThemeColor}" 
                       FontSize="20" FontAttributes="Bold" HorizontalOptions="Center"/>

                <Border Stroke="{Binding ThemeColor}" StrokeThickness="2" 
                        StrokeShape="RoundRectangle 15" BackgroundColor="#1E293B" 
                        Padding="20,10" HeightRequest="80">
                    <Grid ColumnDefinitions="Auto, *">
                        <Label Grid.Column="0" Text="R$" 
                               TextColor="{Binding ThemeColor}" 
                               FontSize="24" FontAttributes="Bold" 
                               VerticalOptions="Center" Margin="0,0,10,0"/>

                        <Entry Grid.Column="1" 
                               Text="{Binding Amount}" 
                               Placeholder="0,00" 
                               TextColor="White" 
                               FontSize="32" 
                               FontAttributes="Bold" 
                               Keyboard="Numeric"
                               BackgroundColor="Transparent"
                               PlaceholderColor="#64748B"/>
                    </Grid>
                </Border>

                <VerticalStackLayout Spacing="5">
                    <Label Text="Descrição" TextColor="#94A3B8" FontSize="12"/>
                    <Border BackgroundColor="#1E293B" StrokeThickness="0" StrokeShape="RoundRectangle 10" Padding="15,0" HeightRequest="50">
                        <Entry Text="{Binding Description}" Placeholder="Ex: Mercado" TextColor="White" VerticalOptions="Center"/>
                    </Border>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="5">
                    <Label Text="Categoria" TextColor="#94A3B8" FontSize="12"/>
                    <Grid ColumnDefinitions="*, 50" ColumnSpacing="10">
                        <Border Grid.Column="0" BackgroundColor="#1E293B" StrokeThickness="0" StrokeShape="RoundRectangle 10" Padding="15,0" HeightRequest="50">
                            <Picker Title="Selecione..." ItemsSource="{Binding Categories}" SelectedItem="{Binding SelectedCategory}"
                                    ItemDisplayBinding="{Binding Name}" TextColor="White" TitleColor="#64748B" VerticalOptions="Center"/>
                        </Border>
                        <Button Grid.Column="1" Text="+" Command="{Binding AddNewCategoryCommand}" 
                                BackgroundColor="#2D3A4F" TextColor="White" FontSize="20" Padding="0"/>
                    </Grid>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="5">
                    <Label Text="Pagar com / Receber em" TextColor="#94A3B8" FontSize="12"/>
                    <Border BackgroundColor="#1E293B" StrokeThickness="0" StrokeShape="RoundRectangle 10" Padding="15,0" HeightRequest="50">
                        <Picker Title="Selecione a origem..." ItemsSource="{Binding PaymentSources}" SelectedItem="{Binding SelectedSource}"
                                ItemDisplayBinding="{Binding Name}" TextColor="White" TitleColor="#64748B" VerticalOptions="Center"/>
                    </Border>
                </VerticalStackLayout>

                <Grid ColumnDefinitions="*, *" ColumnSpacing="15">
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Data" TextColor="#94A3B8" FontSize="12"/>
                        <Border BackgroundColor="#1E293B" StrokeThickness="0" StrokeShape="RoundRectangle 10" Padding="5,0" HeightRequest="50">
                            <DatePicker Date="{Binding Date}" TextColor="White" Format="dd/MM/yyyy" VerticalOptions="Center" HorizontalOptions="Center"/>
                        </Border>
                    </VerticalStackLayout>

                    <VerticalStackLayout Spacing="5">
                        <Label Text="Confirmado?" TextColor="#94A3B8" FontSize="12"/>
                        <Border BackgroundColor="#1E293B" StrokeThickness="0" StrokeShape="RoundRectangle 10" Padding="10,0" HeightRequest="50">
                            <Grid ColumnDefinitions="Auto, *">
                                <Switch IsToggled="{Binding IsPaid}" OnColor="{Binding ThemeColor}" VerticalOptions="Center"/>
                                <Label Grid.Column="1" Text="{Binding IsPaid, Converter={StaticResource InvertedBoolConverter}, ConverterParameter='Pendente'}" 
                                       TextColor="White" VerticalOptions="Center" HorizontalOptions="Center" FontSize="12"/>
                            </Grid>
                        </Border>
                    </VerticalStackLayout>
                </Grid>

                <Border IsVisible="{Binding ShowInstallmentOption}" 
                        Stroke="{Binding ThemeColor}" StrokeThickness="1" StrokeShape="RoundRectangle 10" 
                        BackgroundColor="Transparent" Padding="15" Margin="0,5">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Parcelar Compra?" TextColor="{Binding ThemeColor}" FontAttributes="Bold"/>
                        <Grid ColumnDefinitions="Auto, *">
                            <Switch IsToggled="{Binding IsInstallment}" OnColor="{Binding ThemeColor}"/>
                            <Entry Grid.Column="1" IsVisible="{Binding IsInstallment}" Text="{Binding InstallmentCount}" 
                                   Placeholder="Nº Parcelas" Keyboard="Numeric" TextColor="White" HorizontalTextAlignment="End"/>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <Grid ColumnDefinitions="Auto, *" Margin="0,5">
                    <Label Text="Repetir todo mês?" TextColor="White" VerticalOptions="Center"/>
                    <Switch Grid.Column="1" IsToggled="{Binding IsRecurring}" OnColor="{Binding ThemeColor}" HorizontalOptions="End"/>
                </Grid>

                <VerticalStackLayout Spacing="15" Margin="0,20,0,50">
                    <Button Text="SALVAR" Command="{Binding SaveAndCloseCommand}" 
                            BackgroundColor="{Binding ThemeColor}" TextColor="#000000" FontAttributes="Bold" HeightRequest="50"/>

                    <Button Text="SALVAR E CONTINUAR" Command="{Binding SaveAndContinueCommand}" 
                            BackgroundColor="Transparent" BorderColor="{Binding ThemeColor}" BorderWidth="1" 
                            TextColor="{Binding ThemeColor}" HeightRequest="50"/>

                    <Button Text="Cancelar" Command="{Binding CancelCommand}" 
                            BackgroundColor="Transparent" TextColor="#64748B" FontSize="14"/>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

        <Grid BackgroundColor="#CC000000" IsVisible="{Binding IsLoading}" ZIndex="99">
            <ActivityIndicator IsRunning="{Binding IsLoading}" Color="{Binding ThemeColor}" VerticalOptions="Center" HorizontalOptions="Center"/>
        </Grid>
    </Grid>
</ContentPage>